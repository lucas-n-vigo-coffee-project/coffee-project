<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,500;1,800&family=Gruppo&family=Kodchasan:wght@200;300;400;600&family=Staatliches&display=swap');
        
        .whatSizeLabel {
            position: absolute;
            top: 20px;
            left: 10px;
            color: black;
            font-family: 'Gruppo';
            font-style: normal;
            font-weight: 400;
            font-size: 3em;
            line-height: 100px;
            text-align: center;
            width: 100%;
        }

        #container{
            transition: all 3s;
        }

        #title{
            font-family: 'Gruppo';
            font-size: 3em;
        }
        @keyframes display {
            from {
                opacity : 0%;
            }
            to {
                opacity: 100%;
            }
        }

        @keyframes hide {
            from {
                opacity: 100%;
            }
            to {
                opacity : 0%;
            }
        }
    </style>
</head>
<body>
    <div id="container" style="height: 90vh; width: 100%; overflow-y: scroll;">
        <div class="mx-auto" style="width: fit-content;">
            <h1 id="title">Time to Pick a Brewsky!</h1>
        </div>
        <hr/>
        <div class="row">
            <div class="col-sm-1 col-md-1"></div>
            <div class="col-sm-4 col-md-4">
                <div id="coffees">

                </div>
            </div>
            <div class="col-sm-1 col-md-1"></div>
            <div class="col-sm-5 col-md-5">
                <form>
                    <label for="roast-selection" class="form-label">Select Roast Type:</label>
                    <select id="roast-selection" class="roast_selection form-control" name="roast_selection">
                        <option selected>all roasts</option>
                        <option>light</option>
                        <option>medium</option>
                        <option>dark</option>
                    </select>
                    <br/>
                    <label for="search_input" class="form-label">Search Coffee's:</label>
                    <input type="text" name="search_input" id="search_input" placeholder="Search our Coffee's" class="search_input form-control"/>
                    <br/>
                    <input id="submit" type="submit"  class="form-control"/>
                    <br/>
                </form>
                <hr/>
                <form class="add_coffee_form" id="add_coffee_form">
                    <br/>
                    <h4 id="add_a_new_coffee_heading">Add a New Coffee</h4>
                    <br/>
                    <label for="new_roast_selection" class="form-label">Select Roast Type:</label>
                    <br/>
                    <select id="new_roast_selection" class="new_roast_selection form-control" name="new_roast_selection">
                        <option>light</option>
                        <option>medium</option>
                        <option>dark</option>
                    </select>
                    <br/>
                    <label for="new_coffee_name_input" class="form-label">Coffee Name:</label>
                    <br/>
                    <input type="text" name="new_coffee_name" placeholder="New Coffee Name" class="new_coffee_name_input form-control" id="new_coffee_name_input"/>
                    <br/>
                    <input type="submit" id="submit_new" name="submit_new" class = "form-control" value="Add Coffee"/>
                    <br/>
                </form>
            </div>
        </div>

        <div class="col-sm-1 col-md-1"></div>
    </div>

    <div class="whatSizeLabel" id="whatSizeLabel">
        What size coffee would you like today?
    </div>

    <!-- Model for the cups -->
    <svg id="cup" class="cup" style="visibility : hidden;z-index: -100;" width="149" height="160" viewBox="0 0 149 160" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M0 13.7439H124.457V145.478H0V13.7439Z" fill="#D9D9D9"/>
        <path d="M124.457 14.5219C124.457 22.5421 96.5963 29.0438 62.2285 29.0438C27.8606 29.0438 0 22.5421 0 14.5219C0 6.50167 27.8606 0 62.2285 0C96.5963 0 124.457 6.50167 124.457 14.5219Z" fill="#BFA2A2"/>
        <path d="M124.457 145.478C124.457 153.498 96.5963 160 62.2285 160C27.8606 160 0 153.498 0 145.478C0 137.458 27.8606 130.956 62.2285 130.956C96.5963 130.956 124.457 137.458 124.457 145.478Z" fill="#D9D9D9"/>
        <path d="M149 47.4554H116.698V57.0502H136.333V106.84H116.698V116.175H149V47.4554Z" fill="#D9D9D9"/>
        <!-- <defs>
            <filter id="f3" x="0" y="0" width="200%" height="200%">
                <feOffset result="offOut" in="SourceAlpha" dx="20" dy="20" />
                <feGaussianBlur result="blurOut" in="offOut" stdDeviation="10" />
                <feBlend in="SourceGraphic" in2="blurOut" mode="normal" />
            </filter>
        </defs> -->
    </svg>
    
    <!-- Model for the conveyer belt piece -->
    <svg id="conveyerPiece" class="conveyorPiece" style="opacity: 0%;z-index: -100;" width="78" height="140" viewBox="0 0 78 140" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M28 0H77.5L49.5 140H0L28 0Z" fill="url(#paint0_linear_3_45)"/>
        <defs>
            <linearGradient id="paint0_linear_3_45" x1="38.75" y1="0" x2="38.75" y2="140" gradientUnits="userSpaceOnUse">
            <stop stop-color="#8F8F8F"/>
            <stop offset="1" stop-color="#8F8F8F" stop-opacity="0"/>
            </linearGradient>
        </defs>
    </svg>
            
    <!-- Bootsrap Integration -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="main.js"></script>

    <!-- Script to control the coffee machine animations -->
    <script>
        let mainContainer = document.getElementById('container')
        mainContainer.style.opacity = '0%'
        mainContainer.height = '100vh'
        mainContainer.style.overflowY = 'scroll'
        let selectedCup = null
        let conveyerPiece = document.getElementById('conveyerPiece')
        let conveyerPieceStyle = window.getComputedStyle(conveyerPiece)

        let velocity = 20
        let distance = Number(conveyerPieceStyle.width.split('px')[0]) / 3
        // console.log("velocity: " + velocity)
        // console.log("distance: " + distance)
        //d = v / t
        //t = d * v

        let t = distance * velocity
        
        let conveyerPieces = []
        let cups = []

    
        //Intialize Cup
        const initializeCup = () => {
            let cup = document.getElementById('cup')
            cup.style.transition = 'all 1s'
            let cupStyle = window.getComputedStyle(cup)

            let cupHeight =  Number(cupStyle.height.split('px')[0])
            let cupWidth = Number(cupStyle.width.split('px')[0])
            // console.log(cupHeight)
            // console.log(cupWidth)
            const sizes = {
                short : {
                    width : cupWidth * 0.28,
                    height : cupHeight * 0.28,
                    left : window.innerWidth < 600 ? window.innerWidth * 0.012 : window.innerWidth * 0.15
                },
                tall : {
                    width : cupWidth * 0.4,
                    height : cupHeight * 0.4,
                    left : window.innerWidth < 600 ? window.innerWidth * 0.17 : window.innerWidth * 0.32
                },
                grande : {
                    width : cupWidth * 0.6,
                    height : cupHeight * 0.6,
                    left : window.innerWidth < 600 ? window.innerWidth * 0.37 : window.innerWidth * 0.53
                },
                venty : {
                    width : cupWidth * 0.8,
                    height : cupHeight * 0.8,
                    left : window.innerWidth < 600 ? window.innerWidth * 0.65 : window.innerWidth * 0.75
                }
            }

            const selectedCupScale = 1.4

            const cupClicked = (cup,type) => {
                if(selectedCup) return
                conveyerPaused = true
                let rusure = confirm(`Are you sure you want a ${type} cup?`) 
                if(rusure){ //If they are sure they want this cup
                    document.getElementById('whatSizeLabel').style.display = 'none'
                    selectedCup = type
                    mainContainer.style.opacity = '100%'
                    cup.style.transform = `scale(${selectedCupScale})`
                    let cupNewLeft = Number((window.innerWidth / 2) - (sizes[type].width / 2)) + 'px'
                    cup.style.left = cupNewLeft
                    cups.filter(c=>c != cup).forEach(c=>{ //Filter out the clicked cup and iterate through the rest
                        c.style.animation = 'hide 2s forwards' //Hide it
                        setTimeout(()=>{ //Wait for 2 secs for the hiding animation to complete
                            c.onclick = null //Remove the onclick event, no need to remove cup in case we want to refactor later to let them change their mind
                        },2000)
                    })
                    cup.style.zIndex = -1
                    setTimeout(()=>{
                        conveyerPaused = false
                    },2000)
                }
            }

            //Make the short cup
            let shortCup = cup.cloneNode(true)
            shortCup.style.visibility = 'visible'
            shortCup.style.position = 'absolute'
            shortCup.style.width = sizes.short.width + 'px'
            shortCup.style.height = sizes.short.height + 'px'
            shortCup.style.left = sizes.short.left
            shortCup.style.top = 330;
            shortCup.style.zIndex = 100;
            document.body.appendChild(shortCup)
            shortCup.onclick = () => cupClicked(shortCup,'short')
            cups.push(shortCup)

            //Make the tall cup
            let tallCup = cup.cloneNode(true)
            tallCup.style.visibility = 'visible'
            tallCup.style.position = 'absolute'
            tallCup.style.width = sizes.tall.width + 'px'
            tallCup.style.height = sizes.tall.height + 'px'
            tallCup.style.left = sizes.tall.left
            tallCup.style.top = 330;
            tallCup.style.zIndex = 100;
            document.body.appendChild(tallCup)
            tallCup.onclick = () => cupClicked(tallCup,'tall')
            cups.push(tallCup)

            //Make the grande cup
            let grandeCup = cup.cloneNode(true)
            grandeCup.style.visibility = 'visible'
            grandeCup.style.position = 'absolute'
            grandeCup.style.width = sizes.grande.width + 'px'
            grandeCup.style.height = sizes.grande.height + 'px'
            grandeCup.style.left = sizes.grande.left
            grandeCup.style.top = 330;
            grandeCup.style.zIndex = 100;
            document.body.appendChild(grandeCup)
            grandeCup.onclick = () => cupClicked(grandeCup,'grande')
            cups.push(grandeCup)

            //Make the venty cup
            let ventyCup = cup.cloneNode(true)
            ventyCup.style.visibility = 'visible'
            ventyCup.style.position = 'absolute'
            ventyCup.style.width = sizes.venty.width + 'px'
            ventyCup.style.height = sizes.venty.height + 'px'
            ventyCup.style.left = sizes.venty.left
            ventyCup.style.top = 330;
            ventyCup.style.zIndex = 100;
            document.body.appendChild(ventyCup)
            ventyCup.onclick = () => cupClicked(ventyCup,'venty')
            cups.push(ventyCup)
            
        }

        let conveyerNewPieceTimer = null
        let conveyerMovePiecesTimer = null
        let conveyerPaused = false
        const createConveyerPiece = () => {
            if(conveyerPaused) return
            let newPiece = conveyerPiece.cloneNode(true)
            // newPiece.style.visibility = 'visible'
            newPiece.style.position = 'absolute'
            newPiece.style.top = 0;
            newPiece.style.left = 0;
            newPiece.style.top = 500;
            conveyerPieces.push(newPiece)
            // console.log(conveyerPieces)
            document.body.appendChild(newPiece)

        }

        window.onblur = () => {
            clearInterval(conveyerNewPieceTimer)
            conveyerPaused = true
        }

        window.onfocus = () => {
            conveyerNewPieceTimer = setInterval(createConveyerPiece,t)
            conveyerPaused = false
        }

        window.onresize = () => {
            cups.forEach(cup=>{
                cup.remove()
            })

            initializeCup()
        }

        const animateConveyer = () => {
            //Conveyer New Piece Timer
            conveyerNewPieceTimer = setInterval(createConveyerPiece,t)
            
            
            //Conveyer Move Pieces Timer
            conveyerMovePiecesTimer = () => {
                if(!conveyerPaused){
                    conveyerPieces.forEach(piece=>{
                        let pieceLeft = Number(piece.style.left.split('px')[0])
                        if(piece.style.animation == ''){
                            piece.style.animation = 'display 2s forwards'
                        }
                        let pieceStyle = window.getComputedStyle(piece)
                        let pieceWidth =  Number(pieceStyle.width.split('px')[0])
                        let rightPieceLimit = (window.innerWidth - pieceWidth)
                        if(pieceLeft > rightPieceLimit){
                            if(pieceStyle.animation == 'display 2s forwards'){
                                piece.style.animation = 'hide 2s forwards'
                            }
                            let newPieceLeft = pieceLeft + Math.floor(distance / 30)
                            piece.style.left = newPieceLeft
                            setTimeout(()=>{
                                piece.remove()
                                setTimeout(()=>{
                                    delete conveyerPieces[conveyerPieces.indexOf(piece)]
                                },1000)
                            },1000)
                        }else{
                            let newPieceLeft = pieceLeft + (distance / 30)
                            piece.style.left = newPieceLeft
                        }
                    })  
                } 
                
                setTimeout(()=>{
                    requestAnimationFrame(conveyerMovePiecesTimer)
                },(t  / (30)))
            }
            conveyerMovePiecesTimer()

        }

        let cupMovementTimer = null
        const animateCup = () =>{
            cupMovementTimer = setInterval(()=>{
                let cupLeft = Number(cup.style.left.split('px')[0])
                let newCupLeft = cupLeft + (distance / 30)
                cup.style.left = newCupLeft   
            },(t / (30 - 10)))
        }

        initializeCup()
        animateConveyer()
    </script> 
</body>
</html>