<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Machine Animation</title>
    <style>
        body{
            overflow: hidden;
        }

        @keyframes display {
            from {
                opacity : 0%;
            }
            to {
                opacity: 100%;
            }
        }

        @keyframes hide {
            from {
                opacity: 100%;
            }
            to {
                opacity : 0%;
            }
        }
    </style>
</head>
<body>
    <svg id="cup" style="visibility : hidden;" width="149" height="160" viewBox="0 0 149 160" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M0 13.7439H124.457V145.478H0V13.7439Z" fill="#D9D9D9"/>
        <path d="M124.457 14.5219C124.457 22.5421 96.5963 29.0438 62.2285 29.0438C27.8606 29.0438 0 22.5421 0 14.5219C0 6.50167 27.8606 0 62.2285 0C96.5963 0 124.457 6.50167 124.457 14.5219Z" fill="#BFA2A2"/>
        <path d="M124.457 145.478C124.457 153.498 96.5963 160 62.2285 160C27.8606 160 0 153.498 0 145.478C0 137.458 27.8606 130.956 62.2285 130.956C96.5963 130.956 124.457 137.458 124.457 145.478Z" fill="#D9D9D9"/>
        <path d="M149 47.4554H116.698V57.0502H136.333V106.84H116.698V116.175H149V47.4554Z" fill="#D9D9D9"/>
        </svg>
        
    <svg id="conveyerPiece" class="conveyorPiece" style="opacity: 0%;" width="78" height="140" viewBox="0 0 78 140" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M28 0H77.5L49.5 140H0L28 0Z" fill="url(#paint0_linear_3_45)"/>
        <defs>
        <linearGradient id="paint0_linear_3_45" x1="38.75" y1="0" x2="38.75" y2="140" gradientUnits="userSpaceOnUse">
        <stop stop-color="#8F8F8F"/>
        <stop offset="1" stop-color="#8F8F8F" stop-opacity="0"/>
        </linearGradient>
        </defs>
        </svg>
            
    <script>
        let selectedCup = null
        let conveyerPiece = document.getElementById('conveyerPiece')
        let conveyerPieceStyle = window.getComputedStyle(conveyerPiece)

        let velocity = 20
        let distance = Number(conveyerPieceStyle.width.split('px')[0])
        console.log("velocity: " + velocity)
        console.log("distance: " + distance)
        //d = v / t
        //t = d * v

        let t = distance * velocity
        
        let conveyerPieces = []

       
        //Intialize Cup
        const initializeCup = () => {
            let cup = document.getElementById('cup')
            let cupStyle = window.getComputedStyle(cup)

            let cupHeight =  Number(cupStyle.height.split('px')[0])
            let cupWidth = Number(cupStyle.width.split('px')[0])
            console.log(cupHeight)
            console.log(cupWidth)
            const sizes = {
                short : {
                    width : cupWidth * 0.28,
                    height : cupHeight * 0.28,
                    left : window.innerWidth * 0.012
                },
                tall : {
                    width : cupWidth * 0.4,
                    height : cupHeight * 0.4,
                    left : window.innerWidth * 0.17
                },
                grande : {
                    width : cupWidth * 0.6,
                    height : cupHeight * 0.6,
                    left : window.innerWidth * 0.37
                },
                venty : {
                    width : cupWidth * 0.8,
                    height : cupHeight * 0.8,
                    left : window.innerWidth * 0.65
                }
            }

            const selectedCupScale = 1.4
            let cups = []

            //Make the short cup
            let shortCup = cup.cloneNode(true)
            shortCup.style.visibility = 'visible'
            shortCup.style.position = 'absolute'
            shortCup.style.width = sizes.short.width + 'px'
            shortCup.style.height = sizes.short.height + 'px'
            shortCup.style.left = sizes.short.left
            shortCup.style.top = 330;
            shortCup.style.zIndex = 100;
            document.body.appendChild(shortCup)
            shortCup.onclick = () => {
                let rusure = confirm("Are you sure you want a short cup?")
                if(rusure){
                    selectedCup = 'short'
                    shortCup.style.transform = `scale(${selectedCupScale})`
                    cups.filter(cup=>cup != shortCup).forEach(cup=>cup.style.animation = 'hide 2s forwards')
                }
            }
            cups.push(shortCup)

            //Make the tall cup
            let tallCup = cup.cloneNode(true)
            tallCup.style.visibility = 'visible'
            tallCup.style.position = 'absolute'
            tallCup.style.width = sizes.tall.width + 'px'
            tallCup.style.height = sizes.tall.height + 'px'
            tallCup.style.left = sizes.tall.left
            tallCup.style.top = 330;
            tallCup.style.zIndex = 100;
            document.body.appendChild(tallCup)
            tallCup.onclick = () => {
                let rusure = confirm("Are you sure you want a short cup?")
                if(rusure){
                    selectedCup = 'tall'
                    tallCup.style.transform = `scale(${selectedCupScale})`
                    cups.filter(cup=>cup != tallCup).forEach(cup=>cup.style.animation = 'hide 2s forwards')
                    conveyerMovePiecesTimer()
                }
            }
            cups.push(tallCup)

            //Make the grande cup
            let grandeCup = cup.cloneNode(true)
            grandeCup.style.visibility = 'visible'
            grandeCup.style.position = 'absolute'
            grandeCup.style.width = sizes.grande.width + 'px'
            grandeCup.style.height = sizes.grande.height + 'px'
            grandeCup.style.left = sizes.grande.left
            grandeCup.style.top = 330;
            grandeCup.style.zIndex = 100;
            document.body.appendChild(grandeCup)
            grandeCup.onclick = () => {
                let rusure = confirm("Are you sure you want a short cup?")
                if(rusure){
                    selectedCup = 'grande'
                    grandeCup.style.transform = `scale(${selectedCupScale})`
                    cups.filter(cup=>cup != grandeCup).forEach(cup=>cup.style.animation = 'hide 2s forwards')
                    conveyerMovePiecesTimer()
                }
            }
            cups.push(grandeCup)

            //Make the venty cup
            let ventyCup = cup.cloneNode(true)
            ventyCup.style.visibility = 'visible'
            ventyCup.style.position = 'absolute'
            ventyCup.style.width = sizes.venty.width + 'px'
            ventyCup.style.height = sizes.venty.height + 'px'
            ventyCup.style.left = sizes.venty.left
            ventyCup.style.top = 330;
            ventyCup.style.zIndex = 100;
            document.body.appendChild(ventyCup)
            ventyCup.onclick = () => {
                conveyerPaused = true
                let rusure = confirm("Are you sure you want a short cup?")
                if(rusure){
                    selectedCup = 'venty'
                    ventyCup.style.transform = `scale(${selectedCupScale})`
                    let ventyCupNewLeft = Number((window.innerWidth / 2) - (sizes.venty.width / 2)) + 'px'
                    console.log(ventyCupNewLeft)
                    ventyCup.style.left = ventyCupNewLeft
                    cups.filter(cup=>cup != ventyCup).forEach(cup=>cup.style.animation = 'hide 2s forwards')
                    setTimeout(()=>{
                        conveyerPaused = false
                    },2000)
                }
            }
            cups.push(ventyCup)
            
        }

        let conveyerNewPieceTimer = null
        let conveyerMovePiecesTimer = null
        let conveyerPaused = false
        const animateConveyer = () => {
            //Conveyer New Piece Timer
            conveyerNewPieceTimer = setInterval(()=>{
                if(conveyerPaused) return
                let newPiece = conveyerPiece.cloneNode(true)
                // newPiece.style.visibility = 'visible'
                newPiece.style.position = 'absolute'
                newPiece.style.top = 0;
                newPiece.style.left = 0;
                newPiece.style.top = 250;
                conveyerPieces.push(newPiece)
                console.log(conveyerPieces)
                document.body.appendChild(newPiece)

            },t)
            
            
            //Conveyer Move Pieces Timer
            conveyerMovePiecesTimer = () => {
                if(!conveyerPaused){
                    conveyerPieces.forEach(piece=>{
                        let pieceLeft = Number(piece.style.left.split('px')[0])
                        if(piece.style.animation == ''){
                            piece.style.animation = 'display 2s forwards'
                        }
                        let pieceStyle = window.getComputedStyle(piece)
                        let pieceWidth =  Number(pieceStyle.width.split('px')[0])
                        let rightPieceLimit = (window.innerWidth - pieceWidth)
                        if(pieceLeft > rightPieceLimit){
                            if(pieceStyle.animation == 'display 2s forwards'){
                                piece.style.animation = 'hide 2s forwards'
                            }
                            let newPieceLeft = pieceLeft + Math.floor(distance / 30)
                            piece.style.left = newPieceLeft
                            setTimeout(()=>{
                                piece.remove()
                                setTimeout(()=>{
                                    delete conveyerPieces[conveyerPieces.indexOf(piece)]
                                },1000)
                            },1000)
                        }else{
                            let newPieceLeft = pieceLeft + (distance / 30)
                            piece.style.left = newPieceLeft
                        }
                    })  
                } 
                
                setTimeout(()=>{
                    requestAnimationFrame(conveyerMovePiecesTimer)
                },(t  / (30)))
            }
            conveyerMovePiecesTimer()

        }

        let cupMovementTimer = null
        const animateCup = () =>{
            cupMovementTimer = setInterval(()=>{
                let cupLeft = Number(cup.style.left.split('px')[0])
                let newCupLeft = cupLeft + (distance / 30)
                cup.style.left = newCupLeft   
            },(t / (30 - 10)))
        }

        initializeCup()
        animateConveyer()










        
        
    </script> 
</body>
</html>